AWPCP.define("awpcp/frontend/actions-section-controller",["jquery","awpcp/jquery-collapsible"],function(a){var b=function(a,b){var c=this;c.template=a.template,c.store=b,c.error="",c.message=""};return a.extend(b.prototype,{render:function(b){var c=this;c.$element||(c.$element=a("<div></div>").appendTo(b)),c.$element.hasClass("rendered")||c.renderTemplate()},renderTemplate:function(){var b=this;b.$element=a(b.template).replaceAll(b.$element).collapsible(),b.$content=b.$element.find(".awpcp-submit-listing-section-content .awpcp-actions-submit-listing-section__edit_mode"),b.$actions=b.$element.find(".awpcp-listing-actions-component"),b.$actions.on("click","[data-action]",function(c){c.preventDefault(),b.onTriggerAction(a(this))}),b.message&&b.showSuccessMessage(b.message),b.error&&b.showErrors([b.error]),b.$element.addClass("rendered")},onTriggerAction:function(a){var b=this;return b.$element.find(".awpcp-message").remove(),a.data("confirmation-message")?void b.showConfirmationMessage(a):void b.execute(a)},showConfirmationMessage:function(b){var c,d,e,f=this;c=a('<div class="awpcp-listing-action-confirmation"></div>'),e=a('<button class="awpcp-cancel-listing-action-button">'+b.data("cancel-button")+"</button>"),d=a('<button class="awpcp-confirm-listing-action-button">'+b.text()+"</button>"),c.append(a("<span>"+b.data("confirmation-message")+"</span>")),c.append(e),c.append(d),e.click(function(a){a.preventDefault(),c.remove(),f.$actions.show()}),c.click(function(a){a.preventDefault(),c.remove(),f.execute(b)}),f.$content.prepend(c),f.$actions.hide()},execute:function(b){var c,d=this;c={url:a.AWPCP.get("ajaxurl"),data:{action:"awpcp_execute_listing_action",listing_action:b.data("action"),listing_id:d.store.getListingId(),nonce:b.data("nonce")},dataType:"json",method:"POST",type:"POST"},a.ajax(c).done(function(a){return"error"===a.status&&a.error&&(d.error=a.error,d.showErrors([a.error])),"ok"===a.status&&a.message&&(d.message=a.message,d.showSuccessMessage(a.message)),"ok"===a.status&&a.redirect_url?void setTimeout(function(){document.location.href=a.redirect_url},1e3):("ok"===a.status&&a.reload&&(d.store.requestSectionUpdate(d.id),d.store.refresh()),void d.$actions.show())})},showSuccessMessage:function(a){var b=this,c=b.$element.find(".awpcp-submit-listing-section-content");c.prepend('<div class="awpcp-message awpcp-message-success notice notice-success success"><p>'+a+"</p></div>")},showErrors:function(b){var c=this;a.each(b,function(a,b){c.$content.prepend('<div class="awpcp-message awpcp-error notice notice-error error"><p>'+b+"</p></div>")})},reload:function(a){var b=this;b.template=a.template,b.renderTemplate()},clear:function(){}}),b}),AWPCP.define("awpcp/frontend/order-section-controller",["jquery","awpcp/categories-selector","awpcp/category-dropdown","awpcp/user-selector","awpcp/payment-terms-list","awpcp/credit-plans-list","awpcp/jquery-collapsible","awpcp/jquery-userfield","awpcp/jquery-validate-methods"],function(a,b,c,d,e,f){var g=function(a,b){var c=this;c.id=a.id,c.template=a.template,c.store=b};return a.extend(g.prototype,{render:function(a){var b=this;return b.$element||(b.renderTemplate(a),b.updateInitialState()),"loading"===b.store.getSectionState(b.id)&&b.store.getListingId()?void b.store.setSectionStateToPreview(b.id):void b.updateTemplate()},renderTemplate:function(g){var h=this;h.$element=a(h.template).collapsible(),g.append(h.$element),h.$editModeContainer=a(".awpcp-order-submit-listing-section__edit_mode"),h.$readModeContainer=a(".awpcp-order-submit-listing-section__read_mode"),h.$listingId=h.$element.find('[name="listing_id"]'),h.$transactionId=h.$element.find('[name="transaction_id"]'),h.$captcha=h.$element.find(".awpcp-captcha"),h.$listOfSelectedCategories=a(".awpcp-order-submit-listing-section--selected-categories"),h.$listingOwner=a(".awpcp-order-submit-listing-section--listing-owner"),h.$paymentTerm=a(".awpcp-order-submit-listing-section--payment-term"),h.$creditPlanLabel=a(".awpcp-order-submit-listing-section--credit-plan-label"),h.$creditPlan=a(".awpcp-order-submit-listing-section--credit-plan"),h.$loadingMessage=h.$readModeContainer.find(".awpcp-order-submit-listing-section--loading-message"),h.$changeSelectionButton=h.$readModeContainer.find(".awpcp-order-submit-listing-section--change-selection-button"),h.$paymentTermList=h.$editModeContainer.find(".awpcp-payment-terms-list"),h.paymentTermsList=new e(h.$paymentTermList,{onChange:function(a){h.store.updateSelectedPaymentTerm(a)}}),h.$categoriesDropdown=g.find(".awpcp-multiple-category-dropdown"),h.$categoriesDropdown.length>0?h.categoriesSelector=new c(h.$categoriesDropdown,{onChange:function(a){h.store.updateSelectedCategories(a)}}):(h.$categoriesDropdown=g.find(".awpcp-category-dropdown"),h.categoriesSelector=new b(h.$categoriesDropdown,{onChange:function(a){h.store.updateSelectedCategories(a)}})),h.$userSelect=g.find(".awpcp-user-selector");var i=a.extend(h.$userSelect.data("configuration"),{onChange:function(b){var c=h.getUserInformation(b.id);c&&a.publish("/user/updated",[c]),h.store.updateSelectedUser(b)}});h.userSelector=new d(h.$userSelect,i),h.creditPlansList=new f(g.find(".awpcp-credit-plans-table"),{onChange:function(a){h.store.updateSelectedCreditPlan(a)}}),h.$editModeContainer.find("form").validate({messages:a.AWPCP.l10n("page-place-ad-order"),submitHandler:function(a,b){b.preventDefault(),h.onContinueButtonClicked()}}),h.paymentTermsList.includesFreePaymentTermOnly()&&h.$paymentTermList.closest(".awpcp-form-spacer").hide(),g.on("click",".awpcp-order-submit-listing-section--change-selection-button",function(a){a.preventDefault(),h.onChangeSelectionButtonClicked()}),a.publish("/user/updated",[h.getSelectedUserInformation()]),a.publish("/categories/change",[h.$categoriesDropdown,h.getSelectedCategoriesIds()]),a.publish("/awpcp/post-listing-page/order-step/ready",[h.$element])},getSelectedUserInformation:function(){var a=this,b=a.userSelector.getSelectedUser();return b?a.getUserInformation(b.id):null},getUserInformation:function(a){var b=this,c=b.$userSelect.find('option[value="'+a+'"]');return c.length?c.data("user-information"):null},getSelectedCategoriesIds:function(){var b=this;return a.map(b.getSelectedCategories(),function(a){return a.id})},getSelectedCategories:function(){var a=this;return a.categoriesSelector.getSelectedCategories()},updateInitialState:function(){var a=this,b=parseInt(a.$listingId.val(),10),c=a.$transactionId.val();b&&a.store.setListingId(b),c&&a.store.setTransactionId(a.$transactionId.val()),a.store.updateSelectedPaymentTerm(a.paymentTermsList.getSelectedPaymentTerm()),a.store.updateSelectedCategories(a.categoriesSelector.getSelectedCategories()),a.store.updateSelectedUser(a.userSelector.getSelectedUser())},updateTemplate:function(){var a=this,b=a.store.getSectionState(a.id);return"loading"===b?void a.showLoadingMode():"preview"===b?void a.showPreviewMode():"read"===b?void a.showReadingMode():void a.updateEditModeTemplate()},showLoadingMode:function(){var a=this;a.showReadingMode(),a.$loadingMessage.show()},showPreviewMode:function(){var a=this;a.showReadingMode(),a.$changeSelectionButton.show()},showReadingMode:function(){var b=this;b.$editModeContainer.hide(),b.$readModeContainer.show(),b.$loadingMessage.hide(),b.$listOfSelectedCategories.empty().text(b.store.getSelectedCategoriesNames().join(", ")),b.$paymentTerm.hide(),b.$creditPlan.hide(),b.$listingOwner.hide();var c=b.store.getSelectedPaymentTerm();c&&(b.$paymentTerm.html(a('[data-id="'+c.type+"-"+c.id+'"]').html()).show(),b.$paymentTerm.find("input").prop("disabled",!0),b.$paymentTerm.find("label").hide(),b.$paymentTerm.find(".awpcp-payment-term-price-in-"+c.mode).show());var d=b.store.getSelectedCreditPlanSummary();d&&b.$creditPlan.show().find("span").html(d),b.store.getSelectedUserId()&&(b.$listingOwner.find("span").html(b.store.getSelectedUserName()),b.$listingOwner.show()),b.$changeSelectionButton.hide()},updateEditModeTemplate:function(){var a=this;a.$readModeContainer.hide(),a.$editModeContainer.show(),a.store.getListingId()&&a.$captcha.hide()},onContinueButtonClicked:function(){var a=this,b=a.store.getListingId();return b&&a.store.isValid("update-listing-order")?(a.updateListingOrder(),void a.store.setSectionStateToLoading(a.id)):!b&&a.store.isValid("create-listing")?(a.createEmptyListing(),void a.store.setSectionStateToLoading(a.id)):void 0},updateListingOrder:function(){var b,c=this;b=c.getListingOrderData(),b.action="awpcp_update_listing_order",b.nonce=a.AWPCP.get("update_listing_order_nonce"),b.listing_id=c.store.getListingId(),b.transaction_id=c.store.getTransactionId(),c.doAjaxRequest(b)},getListingOrderData:function(){var a,b,c,d=this;return a=d.store.getSelectedPaymentTerm(),b=d.store.getSelectedCreditPlanId(),c={categories:d.store.getSelectedCategoriesIds(),payment_term_id:a.id,payment_term_type:a.type,payment_term_payment_type:a.mode,credit_plan:b,user_id:d.store.getSelectedUserId(),custom:d.store.getCustomData(),current_url:document.location.href}},doAjaxRequest:function(b){var c=this;c.$element.find(".awpcp-message.awpcp-error").remove(),callback=function(){b=a.extend(b,c.getCaptchaFields());var d={url:a.AWPCP.get("ajaxurl"),data:b,dataType:"json",method:"POST",type:"POST"};a.ajax(d).done(function(a){if("ok"===a.status&&a.redirect_url)return void(document.location.href=a.redirect_url);"ok"===a.status&&(c.store.setOrderModifiedDate(new Date),c.store.setTransactionId(a.transaction),c.store.setListingId(a.listing.ID)),"error"===a.status&&a.errors&&(c.showErrors(a.errors),c.store.setSectionStateToPreview(c.id));var b=c.$captcha.find(".awpcp-recaptcha").attr("data-recaptcha-widget-id");"undefined"!=typeof grecaptcha&&grecaptcha.reset&&void 0!==b&&grecaptcha.reset(b)})},window.AWPCPGetReCaptchaResponse?window.AWPCPGetReCaptchaResponse(callback):callback()},getCaptchaFields:function(){var a=this;return a.$captcha.find('[name="captcha-hash"]').length?{captcha:a.$captcha.find('[name="captcha"]').val(),"captcha-hash":a.$captcha.find('[name="captcha-hash"]').val()}:a.$captcha.find('[name="g-recaptcha-response"]').length?{"g-recaptcha-response":a.$captcha.find('[name="g-recaptcha-response"]').val()}:a.$captcha.find('[name="awpcp_recaptcha_v3_response"]').length?{awpcp_recaptcha_v3_response:a.$captcha.find('[name="awpcp_recaptcha_v3_response"]').val()}:{}},createEmptyListing:function(){var b,c=this;b=c.getListingOrderData(),b.action="awpcp_create_empty_listing",b.nonce=a.AWPCP.get("create_empty_listing_nonce"),c.doAjaxRequest(b)},onChangeSelectionButtonClicked:function(){var a=this;a.store.setSectionStateToEdit(a.id)},reload:function(){},clear:function(){var a=this;"read"!==a.store.getSectionState(a.id)&&(a.paymentTermsList.clearSelectedPaymentTerm(),a.categoriesSelector.clearSelectedCategories(),a.creditPlansList.clearSelectedCreditPlan(),a.updateInitialState(),a.store.setSectionStateToEdit(a.id))},showErrors:function(b){var c,d=this;c=d.$element.find(".awpcp-order-submit-listing-section__read_mode .form-submit"),a.each(b,function(a,b){c.before('<div class="awpcp-message awpcp-error notice notice-error error"><p>'+b+"</p></div>")})}}),g}),AWPCP.define("awpcp/frontend/listing-dates-section-controller",["jquery","awpcp/datepicker-field"],function(a,b){var c=function(a,b){var c=this;c.id=a.id,c.template=a.template,c.store=b};return a.extend(c.prototype,{render:function(b){var c=this;return c.$element||(c.$element=a("<div></div>").appendTo(b)),c.shouldUpdateTemplate()?(c.updateSelectedValues(),c.prepareToUpdateTemplate()):(c.updateSelectedValues(),void c.prepareTemplate())},shouldUpdateTemplate:function(){var a=this,b=a.store.getListingId();return null!==b&&b!==a.listing},prepareToUpdateTemplate:function(){var a=this,b=a.store.getSectionState(a.id);"disabled"!==b&&a.store.setSectionStateToLoading(a.id),a.store.requestSectionUpdate(a.id)},updateSelectedValues:function(){var a=this;a.listing=a.store.getListingId()},prepareTemplate:function(){var a=this;a.$element.hasClass("rendered")||a.renderTemplate(),a.updateTemplate()},renderTemplate:function(){var c=this;c.$element=a(c.template).replaceAll(c.$element).collapsible(),c.$startDate=c.$element.find('[name="start_date"]'),c.$endDate=c.$element.find('[name="end_date"]'),c.$element.find("[datepicker-placeholder]").each(function(){a.noop(new b(a(this).siblings("[name]:hidden"),{datepicker:{onSelect:function(a,b){var d={};d[b.id]=b.settings.altField.val(),c.store.updateListingFields(d)}}}))}),c.$element.addClass("rendered")},updateTemplate:function(){var a=this,b=a.store.getSectionState(a.id);return"disabled"===b?a.showDisabledMode():"loading"===b?a.showLoadingMode():a.showEditMode()},showDisabledMode:function(){var a=this;a.$element.hide()},showLoadingMode:function(){var a=this;a.$element.find(".awpcp-listing-dates-submit-listing-section__loading_mode").show(),a.$element.find(".awpcp-listing-dates-submit-listing-section__edit_mode").hide(),a.$element.show()},showEditMode:function(){var a=this;a.$element.find(".awpcp-listing-dates-submit-listing-section__loading_mode").hide(),a.$element.find(".awpcp-listing-dates-submit-listing-section__edit_mode").show(),a.$element.show()},reload:function(a){var b=this;b.template=a.template,b.$element.removeClass("rendered"),b.prepareTemplate()},clear:function(){var a=this;a.$element.find("[datepicker-placeholder]").val(null).trigger("change")}}),c}),AWPCP.define("awpcp/frontend/listing-fields-section-controller",["jquery","awpcp/settings","awpcp/restricted-length-field","awpcp/multiple-region-selector-validator","awpcp/datepicker-field","awpcp/jquery-collapsible","awpcp/jquery-validate-methods"],function(a,b,c,d,e){var f=function(a,b){var c=this;c.id=a.id,c.template=a.template,c.store=b,c.listing=null,c.selectedCategories=[],c.selectedPaymentTerm=null,c.selectedUserId=null,c.updater=null};return a.extend(f.prototype,{render:function(b){var c=this;return c.$element||(c.$element=a("<div></div>").appendTo(b)),c.shouldUpdateTemplate()?(c.updateSelectedValues(),c.store.setSectionStateToLoading(c.id),c.store.requestSectionUpdate(c.id)):(c.updateSelectedValues(),void c.prepareTemplate())},shouldUpdateTemplate:function(){var a=this,b=a.store.getListingId();if(null===b)return!1;if(b!==a.listing)return!0;var c=a.store.getSelectedCategoriesIds(),d=a.store.getSelectedPaymentTermId(),e=a.store.getSelectedUserId(),f=a.store.getOrderModifiedDate();return 0!==c.length&&null!==d&&(!_.isEqual(c,a.selectedCategories)||(d!==a.selectedPaymentTerm||(e!==a.selectedUserId||f!==a.orderModifiedDate)))},prepareTemplate:function(){var a=this;a.$element.hasClass("rendered")||a.renderTemplate(),a.shouldHideTemplate()?a.showDisabledMode():a.updateTemplate()},renderTemplate:function(){var d=this,f=d.store.getListingFields();d.$element=a(d.template).replaceAll(d.$element).slice(0,d.$element.length),d.$element.collapsible(),d.$element.addClass("rendered"),d.$regionsSelector=d.$element.find(".awpcp-multiple-region-selector"),b.get("overwrite-contact-information-on-user-change"),a.noop(new c(d.$element.find('[name="ad_title"]'))),a.noop(new c(d.$element.find('[name="ad_details"]'))),d.$regionsSelector.length&&d.$regionsSelector.MultipleRegionSelector(f.regions),d.$element.find("[datepicker-placeholder]").each(function(){a.noop(new e(a(this).siblings("[name]:hidden"),{datepicker:{onSelect:function(a,b){var c={};c[b.id]=b.settings.altField.val(),d.store.updateListingFields(c)}}}))}),a.publish("/awpcp/post-listing-page/details-step/ready",[d.$element,d.store]),d.$element.find("form").validate({messages:a.AWPCP.l10n("submit-listing-form-fields"),onfocusout:!1}),d.$element.on("change",".awpcp-has-value",function(){d.onContinueButtonClicked()}),d.onContinueButtonClicked()},onContinueButtonClicked:function(){var b=this,c={};b.$element.find(".awpcp-has-value").each(function(b,d){var e=a(d),f=e.attr("type"),g=e.attr("name");("radio"!==f&&"checkbox"!==f||e.is(":checked"))&&("undefined"!=typeof c[g]&&a.isArray(c[g])?c[g].push(e.val()):"undefined"!=typeof c[g]?c[g]=[c[g],e.val()]:c[e.attr("name")]=e.val())}),b.$regionsSelector.length&&(c.regions=b.$regionsSelector.data("RegionSelector").getSelectedRegions()),b.store.updateListingFields(c)},shouldHideTemplate:function(){var a=this;return 0===a.selectedCategories.length||(null===a.selectedUserId||null===a.selectedPaymentTerm)},updateTemplate:function(){var a=this,b=a.store.getSectionState(a.id);return"disabled"===b?a.showDisabledMode():"loading"===b?a.showLoadingMode():a.showEditMode()},showDisabledMode:function(){var a=this;a.$element.hide()},showLoadingMode:function(){var a=this;a.$element.find(".awpcp-listing-fields-submit-listing-section__loading_mode").show(),a.$element.find(".awpcp-listing-fields-submit-listing-section__edit_mode").hide(),a.$element.show()},showEditMode:function(){var b,c=this;c.$element.find(".awpcp-listing-fields-submit-listing-section__loading_mode").hide(),c.$element.find(".awpcp-listing-fields-submit-listing-section__edit_mode").show(),b=c.store.getListingFields(),a.each(b,function(b,c){a('[name="'+b+'"]').each(function(){var b=a(this),d=b.attr("type"),e=a.isArray(c);if("checkbox"===d||"radio"===d)e&&a.inArray(b.val(),c)!==-1?b.prop("checked",!0):e||c!==b.val()?b.prop("checked",!1):b.prop("checked",!0);else{if("hidden"===d)return;b.val(c)}})}),c.$element.show()},updateSelectedValues:function(){var a=this;a.listing=a.store.getListingId(),a.selectedCategories=a.store.getSelectedCategoriesIds(),a.selectedPaymentTerm=a.store.getSelectedPaymentTermId(),a.selectedUserId=a.store.getSelectedUserId(),a.orderModifiedDate=a.store.getOrderModifiedDate()},reload:function(a){var b=this;b.template=a.template,b.$element.removeClass("rendered"),b.prepareTemplate()},clear:function(){var a=this;a.$element.find(".awpcp-has-value").not("[readonly]").val(null).trigger("change"),a.$regionsSelector.length&&a.$regionsSelector.data("RegionSelector").clearSelectedRegions()},validate:function(a){var b=this;if("update-listing-order"===a)return[];var c=b.$element.find("form"),e=!1,f=!1;return e=d.showErrorsIfUserSelectedDuplicatedRegions(c),f=d.showErrorsIfRequiredFieldsAreEmpty(c),!c.valid()||e||f?[!0]:[]},showErrors:function(){}}),f}),AWPCP.define("awpcp/frontend/save-section-controller",["jquery"],function(a){var b=function(a,b){var c=this;c.id=a.id,c.template=a.template,c.store=b};return a.extend(b.prototype,{render:function(b){var c=this;return c.$element||(c.$element=a("<div></div>").appendTo(b)),c.shouldUpdateSectionState()?(c.updateSelectedValues(),c.store.setSectionStateToEdit(c.id)):void c.prepareTemplate()},shouldUpdateSectionState:function(){var a=this,b=a.store.getListingId();return null!==b&&b!==a.listing},updateSelectedValues:function(){var a=this;a.listing=a.store.getListingId()},prepareTemplate:function(){var a=this;a.$element.hasClass("rendered")||a.renderTemplate();var b=a.store.getSectionState(a.id);return"disabled"===b?a.showDisabledMode():void a.showEditMode()},renderTemplate:function(){var b=this;b.$element=a(b.template).replaceAll(b.$element),b.$previewButton=b.$element.find(".awpcp-preview-listing-button"),b.$submitButton=b.$element.find(".awpcp-submit-listing-button"),b.$resetButton=b.$element.find('[type="reset"]'),b.$previewContainer=b.$element.find(".awpcp-listing-preview-container"),b.$errorsSibling=b.$submitButton.closest(".form-submit"),b.$previewContainer.hide(),b.$previewButton.click(function(a){a.preventDefault(),b.store.isValid()&&b.saveListingInformationAndShowPreview()}),b.$submitButton.click(function(a){a.preventDefault(),b.store.isValid()&&b.saveListingInformationAndRedirect()}),b.$resetButton.click(function(a){a.preventDefault(),b.clearListingInformation()}),b.$element.addClass("rendered")},saveListingInformationAndShowPreview:function(){var a=this;a.saveListingInformation().done(function(){a.showListingPreview()})},saveListingInformation:function(){var b=this,c=a.Deferred();return b.clearErrors(),b.doSaveListingRequest().done(function(a){return"ok"===a.status&&a.redirect_url?void c.resolve(a):"error"===a.status&&a.errors?(b.showErrors(a.errors),void c.reject(a)):void 0}),c},doSaveListingRequest:function(){var b,c,d,e,f,g,h=this;b=h.store.getSelectedPaymentTerm(),c=h.store.getSelectedCreditPlanId(),e=[],f=0,d=a.extend({},h.store.getListingFields(),{action:"awpcp_save_listing_information",nonce:a.AWPCP.get("save_listing_information_nonce"),transaction_id:h.store.getTransactionId(),ad_id:h.store.getListingId(),user_id:h.store.getSelectedUserId(),categories:h.store.getSelectedCategoriesIds(),payment_term_id:h.store.getSelectedPaymentTermId(),payment_term_type:b.type,payment_type:b.mode,credit_plan:c,custom:h.store.getCustomData(),current_url:document.location.href}),d.regions&&d.regions.length&&(f=d.regions.length);for(var i=0;i<f;i+=1){var j={};a.each(d.regions[i],function(a,b){b.selected&&(j[b.type]=b.selected)}),j&&e.push(j)}return d.regions=e,g={url:a.AWPCP.get("ajaxurl"),data:d,dataType:"json",method:"POST",type:"POST"},a.ajax(g)},clearErrors:function(){var a=this;a.$element.find(".awpcp-message.awpcp-error").remove()},showErrors:function(b){var c=this;a.each(b,function(a,b){c.$errorsSibling.before('<div class="awpcp-message awpcp-error notice notice-error error"><p>'+b+"</p></div>")})},showListingPreview:function(){var a=this;a.doGenerateListingPreviewRequest().done(function(b){"ok"===b.status&&b.preview&&(a.preview=b.preview,a.$previewButton.blur(),a.store.refresh())})},doGenerateListingPreviewRequest:function(){var b,c,d=this;return b={action:"awpcp_generate_listing_preview",ad_id:d.store.getListingId()},c={url:a.AWPCP.get("ajaxurl"),data:b,dataType:"json",method:"POST",type:"POST"},a.ajax(c)},saveListingInformationAndRedirect:function(){var a=this;a.saveListingInformation().done(function(a){a.redirect_url&&(document.location.href=a.redirect_url)})},clearListingInformation:function(){var a=this;a.store.clearSections()},showDisabledMode:function(){var a=this;a.$element.hide()},showEditMode:function(){var a=this;a.preview&&(a.$previewButton.val(a.$previewButton.data("refresh-label")),a.$previewContainer.html(a.preview).show()),a.$element.show()},reload:function(a){var b=this;b.template=a.template,b.$element.removeClass("rendered"),b.prepareTemplate()},clear:function(){}}),b}),AWPCP.define("awpcp/frontend/upload-media-section-controller",["jquery","awpcp/media-center","awpcp/settings","awpcp/jquery-collapsible"],function(a,b,c){var d=function(a,b){var c=this;c.id=a.id,c.template=a.template,c.store=b,c.selectedPaymentTerm=null,c.listing=null};return a.extend(d.prototype,{render:function(b){var c=this;return c.$element||(c.$element=a("<div></div>").appendTo(b)),c.shouldUpdateTemplate()?(c.updateSelectedValues(),c.store.setSectionStateToLoading(c.id),c.store.requestSectionUpdate(c.id)):(c.updateSelectedValues(),void c.prepareTemplate())},shouldUpdateTemplate:function(){var a=this,b=a.store.getListingId();if(null===b)return!1;if(b!==a.listing)return!0;var c=a.store.getSelectedPaymentTermId(),d=a.store.getOrderModifiedDate();return null!==c&&(c!==a.selectedPaymentTerm||d!==a.orderModifiedDate)},updateSelectedValues:function(){var a=this;a.selectedPaymentTerm=a.store.getSelectedPaymentTermId(),a.listing=a.store.getListingId(),a.orderModifiedDate=a.store.getOrderModifiedDate()},prepareTemplate:function(){var a=this;a.$element.hasClass("rendered")||a.renderTemplate(),a.shouldHideTemplate()?a.showDisabledMode():a.updateTemplate()},renderTemplate:function(){var b=this;b.$element=a(b.template).replaceAll(b.$element).collapsible(),b.$element.find(".awpcp-media-center").StartMediaCenter({mediaManagerOptions:c.get("media-manager-data"),mediaUploaderOptions:c.get("media-uploader-data")}),b.$element.addClass("rendered")},shouldHideTemplate:function(){var a=this;return null===a.selectedPaymentTerm},updateTemplate:function(){var a=this,b=a.store.getSectionState(a.id);return"disabled"===b?a.showDisabledMode():"loading"===b?a.showLoadingMode():a.showEditMode()},showDisabledMode:function(){var a=this;a.$element.hide()},showLoadingMode:function(){var a=this;a.$element.find(".awpcp-upload-media-listing-section__loading_mode").show(),a.$element.find(".awpcp-upload-media-listing-section__edit_mode").hide(),a.$element.show()},showEditMode:function(){var a=this;a.$element.find(".awpcp-upload-media-listing-section__loading_mode").hide(),a.$element.find(".awpcp-upload-media-listing-section__edit_mode").show(),a.$element.show()},reload:function(a){var b=this;b.template=a.template,b.$element.removeClass("rendered"),b.prepareTemplate()},clear:function(){}}),d}),AWPCP.define("awpcp/frontend/submit-listing-data-store",["jquery"],function(a){var b=function(a){this.data=a||{},this.listener=null,this.mode="",this.refreshCalls=0};return a.extend(b.prototype,{setSectionStateToPreview:function(a){var b=this;b.setSectionState(a,"preview")},setSectionStateToRead:function(a){var b=this;b.setSectionState(a,"read")},setSectionState:function(a,b){var c=this;c.setSectionStateWithoutRefreshing(a,b),c.refresh()},setSectionStateWithoutRefreshing:function(a,b){var c=this;"undefined"==typeof c.data.sections&&(c.data.sections={}),"undefined"==typeof c.data.sections[a]&&(c.data.sections[a]={}),c.data.sections[a].state=b},setSectionStateToEdit:function(a){var b=this;b.setSectionState(a,"edit")},setSectionStateToLoading:function(a){var b=this;b.setSectionState(a,"loading")},refresh:function(){var a=this;a.refreshCalls=a.refreshCalls+1,"undefined"==typeof a.data.sectionsToUpdate&&(a.data.sectionsToUpdate=[]),a.listener.render(),a.refreshCalls=a.refreshCalls-1,a.refreshCalls<=0&&a.data.sectionsToUpdate.length&&a.updateSections()},getSectionState:function(a){var b=this;return b.data.sections&&b.data.sections[a]&&b.data.sections[a].state?b.data.sections[a].state:"edit"},requestSectionUpdate:function(a){var b=this;b.data.sectionsToUpdate.push(a)},updateSelectedCategories:function(a){var b=this;b.data.categories=a,b.refresh()},getSelectedCategoriesIds:function(){var b=this;return a.map(b.data.categories||[],function(a){return a.id})},getSelectedCategoriesNames:function(){var b=this;return a.map(b.data.categories||[],function(a){return a.name})},updateSelectedUser:function(a){var b=this;b.data.user=a,b.refresh()},getSelectedUserId:function(){var a=this;return a.data.user?a.data.user.id:null},getSelectedUserName:function(){var a=this;return a.data.user?a.data.user.name:""},updateSelectedPaymentTerm:function(a){var b=this;b.data.paymentTerm=a,b.refresh()},getSelectedPaymentTerm:function(){var a=this;return a.data.paymentTerm?a.data.paymentTerm:null},getSelectedPaymentTermId:function(){var a=this;return a.data.paymentTerm?a.data.paymentTerm.id:null},getSelectedPaymentTermSummary:function(){var a=this;return a.data.paymentTerm?a.data.paymentTerm.summary:""},updateSelectedCreditPlan:function(a){var b=this;b.data.creditPlan=a,b.refresh()},getSelectedCreditPlan:function(){var a=this;return a.data.creditPlan?a.data.creditPlan:null},getSelectedCreditPlanId:function(){var a=this;return a.data.creditPlan?a.data.creditPlan.id:null},getSelectedCreditPlanSummary:function(){var a=this;return a.data.creditPlan?a.data.creditPlan.summary:""},setCAPTCHAAnswer:function(a){var b=this;b.data.captcha=a},getCAPTCHAAnswer:function(){var a=this;return a.data.captcha?a.data.captcha:{}},setTransactionId:function(a){var b=this;b.data.transaction=a},getTransactionId:function(){var a=this;return a.data.transaction?a.data.transaction:null},setOrderModifiedDate:function(a){var b=this;b.data.order={modifiedDate:a}},getOrderModifiedDate:function(){var a=this;return"undefined"==typeof a.data.order?null:"undefined"==typeof a.data.order.modifiedDate?null:a.data.order.modifiedDate},updateListingFields:function(b){var c=this;c.data.fields=a.extend(c.data.fields||{},b),c.refresh()},setListingId:function(a){var b=this;a&&(b.data.listing={ID:a},b.refresh())},getListingId:function(){var a=this;return a.data.listing?a.data.listing.ID:null},getListingFields:function(){var a=this;return a.data.fields||{}},updateCustomData:function(b){var c=this;c.data.custom=a.extend(c.data.custom||{},b),c.refresh()},getCustomData:function(){var a=this;return a.data.custom||{}},updateSections:function(){var b,c,d,e=this;e.updateSectionsTimeout&&clearTimeout(e.updateSectionsTimeout),b={action:"awpcp_update_submit_listing_sections",sections:e.data.sectionsToUpdate,mode:e.mode,nonce:a.AWPCP.get("update_submit_listing_sections_nonce"),listing:e.getListingId(),transaction_id:e.getTransactionId()},c={url:a.AWPCP.get("ajaxurl"),data:b,dataType:"json",method:"POST",type:"POST"},e.updateSectionsTimeout=setTimeout(function(){d=a.ajax(c).done(function(a){"ok"===a.status&&e.listener.reload(a.sections),e.data.sectionsToUpdate=[]})},250)},clearSections:function(){var a=this;a.listener.clear()},isValid:function(a){return this.listener.validate(a)}}),b}),AWPCP.run("awpcp/frontend/submit-listing-page",["jquery","awpcp/frontend/submit-listing-data-store","awpcp/frontend/actions-section-controller","awpcp/frontend/order-section-controller","awpcp/frontend/listing-fields-section-controller","awpcp/frontend/listing-dates-section-controller","awpcp/frontend/upload-media-section-controller","awpcp/frontend/save-section-controller"],function(a,b,c,d,e,f,g,h){var i=function(a,b,c){var d=this;d.store=a,d.sections=b,d.$container=c};a.extend(i.prototype,{render:function(){var b=this;a.each(b.sections,function(a,c){c.render(b.$container)})},reload:function(b){var c=this;a.each(b,function(a,b){"undefined"!=typeof c.sections[b.id]&&(c.store.setSectionStateWithoutRefreshing(b.id,b.state),c.sections[b.id].reload(b,c.$container))})},clear:function(){var b=this;a.each(b.sections,function(a,b){b.clear()})},validate:function(b){var c=this,d={},e=0;return a.each(c.sections,function(a,c){c.validate&&(d[c.id]=c.validate(b),e+=d[c.id].length)}),0===e||(a.each(d,function(a,b){c.sections[a].showErrors(b)}),void a("html, body").animate({scrollTop:c.$container.find(".awpcp-error:visible").eq(0).offset().top-200},"fast"))}}),a(function(){var j,k=new b,l={};j={actions:c,order:d,"listing-dates":f,"listing-fields":e,"upload-media":g,save:h},a.publish("awpcp/register-submit-listing-section-controllers",[j]),a.each(AWPCPSubmitListingPageData.sections,function(a,b){l[a]=new j[a](b,k),k.setSectionStateWithoutRefreshing(b.id,b.state)}),k.listener=new i(k,l,a(".awpcp-submit-listing-page-form")),k.mode=AWPCPSubmitListingPageData.mode,k.refresh()})});