function AWPCPError(a){this.name="AWPCPError",this.message=a||"AWPCP Error."}!function(a){var b=a({});a.subscribe=function(){b.bind.apply(b,arguments)},a.unsubscribe=function(){b.unbind.apply(b,arguments)},a.publish=function(){b.trigger.apply(b,arguments)}}(jQuery),function(a){var b=function(){"object"==typeof __awpcp_js_data?this.options=__awpcp_js_data:this.options={},"object"==typeof __awpcp_js_l10n?this.localization=__awpcp_js_l10n:this.localization={},null===this.get("ajaxurl")&&("undefined"!=typeof b&&b.ajaxurl?this.set("ajaxurl",b.ajaxurl):"undefined"!=typeof ajaxurl?this.set("ajaxurl",ajaxurl):this.set("ajaxurl","/wp-admin/admin-ajax.php"))};a.extend(b.prototype,{set:function(a,b){return this.options[a]=b,this},get:function(b,c){var d=this;return"undefined"!=typeof awpcp&&awpcp.options&&awpcp.options.length&&(a.each(awpcp.options,function(a,b){d.set(b[0],b[1])}),delete awpcp.options),this.options[b]?this.options[b]:c?c:null},l10n:function(b,c){var d=this;if("undefined"!=typeof awpcp&&awpcp.localization&&awpcp.localization.length&&(a.each(awpcp.localization,function(a,b){d.localization[b[0]]=b[1]}),delete awpcp.localization),this.localization.hasOwnProperty(b)){if(!c)return this.localization[b];if(c&&this.localization[b].hasOwnProperty(c))return this.localization[b][c]}return""},validate:function(b){"undefined"!=typeof a.validator&&a.validator.setDefaults(b)}}),a.AWPCP=new b,a.AWPCP.PaginationForm=function(b){this.form=a(b),this.form.find("select").change(function(){this.form.submit()})},a.AWPCP.MainMenu=function(b){var c=this;c.container=a(b),c.toggle=c.container.find(".awpcp-menu-toggle"),c.toggle.click(function(){c.container.toggleClass("toggle-on")})},a(function(){a(".awpcp-pagination-form").each(function(){a.noop(new a.AWPCP.PaginationForm(this))}),a(".awpcp-navigation").each(function(){a.noop(new a.AWPCP.MainMenu(a(this)))})})}(jQuery),AWPCPError.prototype=new Error,AWPCPError.prototype.constructor=AWPCPError;var AWPCP=function(){function a(a,b,c){h[a]={dependencies:b,handler:c}}function b(b,d,e){a(b,d,e),c(b)}function c(a){try{d(a)}catch(b){if(!(b instanceof AWPCPError))throw b;g("AWPCP: "+b.message)}}function d(a){var b=h[a];if(i[a])return i[a];if(void 0===b)throw new AWPCPError("Dependency ["+a+"] not found.");for(var c=[],e=b.dependencies.length-1;e>=0;e-=1)c.unshift(d(b.dependencies[e]));return i[a]=b.handler.apply(null,c),i[a]}function e(a,b){return console&&console[a]&&console[a].apply&&console[a].apply(console,b)}function f(){return e("log",arguments)}function g(){return e("error",arguments)}var h={},i={};return{instantiate:c,define:a,run:b,log:f,error:g}};AWPCP=new AWPCP(window),AWPCP.define("jquery",[],function(){return jQuery}),AWPCP.define("knockout",[],function(){return ko}),AWPCP.define("moment",[],function(){return moment}),AWPCP.define("awpcp/categories-selector-helper",["jquery"],function(a){var b=function(a,b,c){var d,e=this;this.allCategories=[],this.allCategoriesIds=[],this.selectedCategoriesIds=a,this.registry={},this.hierarchy={},this.parents={},this.namesRegistry={},this.paymentTerms=c;var f=function(a,c){"undefined"!=typeof b[a]&&("undefined"==typeof e.hierarchy[a]&&(e.hierarchy[a]=[]),_.each(b[a],function(b){var g=b.name.replace(/&amp;/g,"&");d={id:b.term_id,text:g,disabled:b.disabled||!1,name:g,parent:"root"!==a?a:null,level:c},e.allCategories.push(d),e.allCategoriesIds.push(d.id),e.hierarchy[a].push(d),e.registry[b.term_id]=d,e.parents[b.term_id]=a,d.fullName=e.getCategoryFullName(d.id),"undefined"!=typeof e.namesRegistry[g]?(e.namesRegistry[g][0].requiresFullName=!0,d.requiresFullName=!0,e.namesRegistry[g].push(d)):e.namesRegistry[g]=[d],f(d.id,c+1)}))};f("root",0)};return a.extend(b.prototype,{getAllCategories:function(){return this.allCategories},getAllCategoriesIds:function(){return this.allCategoriesIds},getCategoriesAncestors:function(a){for(var b,c=[],d=0;d<a.length;d+=1){b=a[d];do c.indexOf(b)===-1&&c.push(b),b=this.getCategoryParent(b);while(b&&"root"!==b)}return c},getCategory:function(a){return this.registry[a]},getCategoryFullName:function(a){for(var b,c=this,d=a,e=[c.getCategory(a).name];"root"!==c.parents[d];)b=c.getCategory(c.parents[d]),d=b.id,e.push(b.name);return e.reverse().join(": ")},getCategoryParent:function(a){return this.parents[a]},getCategoryChildren:function(a){return"undefined"!=typeof this.hierarchy[a]?this.hierarchy[a]:[]},updateSelectedCategories:function(a){this.selectedCategoriesIds=a},getCategoriesThatCanBeSelectedTogether:function(){var a=this;if(0===a.paymentTerms.length)return a.allCategoriesIds;for(var b=_.compact(_.map(_.keys(a.paymentTerms),function(b){var c=a.paymentTerms[b];return c.categories.length>0&&0!==_.difference(a.selectedCategoriesIds,c.categories).length?null:c.numberOfCategoriesAllowed>0&&c.numberOfCategoriesAllowed<=a.selectedCategoriesIds.length?null:c})),c=[],d=b.length-1;d>=0;d-=1){if(0===b[d].categories.length){c=a.allCategoriesIds;break}c=_.union(c,b[d].categories)}return c}}),b}),AWPCP.define("awpcp/categories-selector",["jquery","awpcp/categories-selector-helper","awpcp/settings"],function(a,b){a.fn.select2.amd.define("awpcp/select2/data/array",["select2/utils","select2/data/array"],function(b,c){var d=function(a,b){this.helper=b.get("helper")||null,this.multiple=b.get("multiple"),this.cache={term:"",items:[]},d.__super__.constructor.call(this,a,b)};return b.Extend(d,c),d.prototype.query=function(b,c){var d=this;d.current(function(e){var f,g=[],h=null;f=a.map(e,function(a){return parseInt(a.id,10)}),h=d.multiple?d.helper.getCategoriesThatCanBeSelectedTogether():d.helper.getAllCategoriesIds(),d.$element.find("option").each(function(){var c=d.item(a(this)),e=d.matches(b,c);null!==e&&(d.shouldDisableCategory(c,f,h)&&(e=a.extend({},e,{disabled:!0})),g.push(e))}),c({results:g})})},d.prototype.shouldDisableCategory=function(a,b,c){var d=parseInt(a.id,10);return null!==c&&(!_.contains(b,d)&&!_.contains(c,d))},d.prototype.matches=function(b,c){var d,e=this;return""===a.trim(b.term)?c:(e.cache.term!==b.term&&(e.cache.term=b.term,e.cache.items=[]),e.cache.items.indexOf(parseInt(c.parent,10))!==-1?(e.cache.items.push(parseInt(c.id,10)),c):c.text.toLowerCase().indexOf(b.term.toLowerCase())!==-1?(e.cache.items.push(parseInt(c.id,10)),c.fullName?(d=c.fullName,a.extend({},c,{text:d})):c):null)},d}),a.fn.select2.amd.define("awpcp/select2/results",["select2/utils","select2/results"],function(b,c){var d=function(a,b,c){d.__super__.constructor.call(this,a,b,c)};return b.Extend(d,c),d.prototype.option=function(b){var c=d.__super__.option.call(this,b),e=b.level?b.level+1:1;return b.id&&a(c).addClass("awpcp-category-dropdown-option-"+b.id).addClass("awpcp-category-dropdown-option-level-"+e),c},d});var c=function(c,d){this.$select=a(c),this.options=a.extend({},window["categories_"+this.$select.attr("data-hash")],d),this.options.helper=new b(this.options.selectedCategoriesIds,this.options.categoriesHierarchy,this.options.paymentTerms),this.$select.on("change.select2",_.bind(this.onChange,this)),this.render()};return a.extend(c.prototype,{onChange:function(){var b=this,c=b.getSelectedCategoriesIds();this.options.helper.updateSelectedCategories(c),a.isFunction(b.options.onChange)&&b.options.onChange(b.getSelectedCategories()),a.publish("/categories/change",[b.$select,c])},getSelectedCategories:function(){var b=this;return a.map(b.$select.selectWoo("data"),function(a){if(""===a.id)return null;var b=parseInt(a.id,10);return{id:b,name:a.text}})},clearSelectedCategories:function(){var a=this;a.$select.val(null).trigger("change")},getSelectedCategoriesIds:function(){var b=this;return a.map(b.$select.selectWoo("data"),function(a){return parseInt(a.id,10)})},render:function(){var b=this,c=a.extend({},this.options.select2),d=this.$select,e=d.find(".awpcp-dropdown-placeholder");c.dataAdapter=a.fn.select2.amd.require("awpcp/select2/data/array"),c.resultsAdapter=a.fn.select2.amd.require("awpcp/select2/results"),c.helper=this.options.helper,c.data=a.map(this.options.helper.getAllCategories(),function(c){return a.inArray(c.id,b.options.selectedCategoriesIds)>=0&&(c.selected=!0),c}),c.templateSelection=function(a){return a.fullName?a.fullName:a.text},e.length?(e.text(""),d.find("option").not(e).remove()):d.empty(),d.selectWoo(c)}}),c}),AWPCP.define("awpcp/category-dropdown",["jquery","awpcp/categories-selector-helper"],function(a,b){const c=function(c,d){var e=this;this.$select=a(c);var f=this.$select.attr("target");this.options=a.extend({},window["categories_"+this.$select.attr("data-hash")],d),this.options.helper=new b(this.options.selectedCategoriesIds,this.options.categoriesHierarchy,this.options.paymentTerms),this.$container=a(".awpcp-multiple-category-dropdown-container"),this.$hidden=a("#awpcp-multiple-category-dropdown-"+f);var g=window["categories_"+f].categoriesHierarchy;this.$container.on("change",".awpcp-multiple-category-dropdown",function(){e.$select=a(this);var b=e.setCategory(this),c=g[b[0]];if(a(this).nextAll(".awpcp-multiple-category-dropdown").remove(),b[0]in g&&c.length>0&&0==e.$select.next(".awpcp-multiple-category-dropdown").length){var d='<select class="awpcp-multiple-category-dropdown"><option value="">'+e.options.subcategoryLabel+"</option></select>";$subDropdown=a(d).insertAfter(a(this));for(var f=0;f<c.length;f+=1)$subDropdown.append(a('<option value="'+c[f].term_id+'">'+c[f].name+"</option>"))}}),this.$container.on("change.categoryDropdown",".awpcp-multiple-category-dropdown",_.bind(this.onChange,this))};return a.extend(c.prototype,{onChange:function(){var b=this.getSelectedCategoriesIds();this.options.helper.updateSelectedCategories(b),a.isFunction(this.options.onChange)&&this.options.onChange(this.getSelectedCategories()),a.publish("/categories/change",[this.$select,this.getSelectedCategories()])},getSelectedCategories:function(){var a=this.$hidden.val();return a=JSON.parse(a),[{id:a[0],name:a[1]}]},getSelectedCategoriesIds:function(){var a=this.$hidden.val();return a=JSON.parse(a),[a[0]]},setCategory:function(){var b=[parseInt(this.$select.val(),10)?parseInt(this.$select.val(),10):null,a("option:selected",this.$select).text()];return null==b[0]&&(this.$select=this.$select.prev(".awpcp-multiple-category-dropdown"),this.$select.length>0&&(b=[parseInt(this.$select.val(),10),a("option:selected",this.$select).text()])),this.$hidden.val(JSON.stringify(b)),b}}),c}),AWPCP.define("awpcp/credit-plans-list",["jquery"],function(a){var b=function(b,c){var d=this;d.$container=a(b),d.options=c,d.setup()};return a.extend(b.prototype,{setup:function(){var a=this;a.$container.on("change",'[name="credit_plan"]',function(){a.onChange()})},onChange:function(){var b=this;a.isFunction(b.options.onChange)&&b.options.onChange(b.getSelectedCreditPlan())},getSelectedCreditPlan:function(){var a=this,b=a.$container.find('[name="credit_plan"]:checked');return{id:b.data("credit-plan-id"),name:b.data("credit-plan-name"),price:b.data("credit-plan-price"),summary:b.data("credit-plan-summary")}},clearSelectedCreditPlan:function(){var a=this;a.$container.find('[name="credit_plan"]').prop("checked",!1)}}),b}),AWPCP.define("awpcp/datepicker-field",["jquery","awpcp/settings"],function(a,b){var c=function(c,d){var e=this;e.element=a(c),e.textfield=e.element.parent().find("[datepicker-placeholder]"),e.textfield.datepicker(a.extend({},b.l10n("datepicker"),{dateFormat:b.get("date-format"),altField:e.element,altFormat:"yy/mm/dd"},d?d.datepicker:{}))};return c}),AWPCP.define("awpcp/file-manager",["jquery","knockout","awpcp/file","awpcp/settings"],function(a,b,c,d){var e=function(c,e,f){var g=this;g.files=b.observableArray([]),g.images=b.observableArray([]),g.attachments=b.observableArray([]),g.imagesAllowed=b.observable(f.imagesAllowed),g.imagesUploaded=b.observable(f.imagesUploaded),g.primaryImageId=b.observable(f.primaryImageId),g.setImageAsPrimary=function(b){g.showLoadingSpinner(b),a.post(d.get("ajaxurl"),{nonce:c,action:"awpcp-set-image-as-primary",listing_id:b.listing_id,file_id:b.id},function(a){"ok"===a.status&&(g.primaryImageId(b.id),g.hideLoadingSpinner(b))})},g.showLoadingSpinner=function(b){a("#file-"+b.id).find(".image-actions .spinner").removeClass("spinner-hidden")},g.hideLoadingSpinner=function(b){a("#file-"+b.id).find(".image-actions .spinner").addClass("spinner-hidden")},g.updateFileEnabledStatus=function(b){var e=this;e.locked||(g.showLoadingSpinner(e),e.locked=!0,a.post(d.get("ajaxurl"),{nonce:c,action:"awpcp-update-file-enabled-status",listing_id:e.listing_id,file_id:e.id,new_status:b},function(a){"ok"!==a.status&&e.enabled(!b),g.hideLoadingSpinner(e),e.locked=!1}))},g.deleteFile=function(b){g.showLoadingSpinner(b),a.post(d.get("ajaxurl"),{nonce:c,action:"awpcp-delete-file",listing_id:b.listing_id,file_id:b.id},function(a){"ok"===a.status&&(g.files.remove(b),b.isImage?g.images.remove(b):g.attachments.remove(b),g.hideLoadingSpinner(b))})},g.prepareFiles(c,e),g.defineComputedProperties()};return a.extend(e.prototype,{prepareFiles:function(b,d){var e=this;a.each(d,function(a,b){var d=new c(b,e.primaryImageId);d.enabled.subscribe(e.updateFileEnabledStatus,d),e[b.isImage?"images":"attachments"].push(d),e.files.push(d)})},defineComputedProperties:function(){var a=this;a.haveFiles=b.computed(function(){return a.files().length>0}),a.haveImages=b.computed(function(){return a.images().length>0}),a.haveAttachments=b.computed(function(){return a.attachments().length>0}),a.canUploadImages=b.computed(function(){return a.imagesAllowed()>a.images().length})}}),e}),AWPCP.define("awpcp/file",["knockout"],function(a){var b=function(b,c){var d=this;d.id=b.id,d.name=b.name,d.listing_id=b.listing_id,d.thumbnailUrl=b.thumbnailUrl,d.iconUrl=b.iconUrl,d.url=b.url,d.enabled=a.observable(parseInt(b.enabled,10)),d.isImage=b.isImage,d.status=a.observable(b.status),d.isPrimaryImage=a.computed(function(){return c()===d.id}),d.getFileClasses=a.computed(function(){var a=[];return d.isPrimaryImage()&&a.push("primary-image"),a.push(d.enabled()?"enabled":"disabled"),a.push(d.status().toLowerCase()),a.join(" ")}),d.getFileId=a.computed(function(){return"file-"+d.id})};return b}),AWPCP.define("awpcp/file-view-model",["knockout"],function(a){var b=function(b){function c(){return"Approved"===g.status()}function d(){return"Rejected"===g.status()}function e(){return"Awaiting-Approval"===g.status()}function f(){return null!==g.progress()}var g=this;g.id=b.id,g.name=b.name,g.listingId=b.listingId,g.mimeType=b.mimeType,g.enabled=a.observable(!!parseInt(b.enabled,10)),g.status=a.observable(b.status),g.isPrimary=a.observable(!!b.isPrimary),g.isApproved=a.computed(c),g.isRejected=a.computed(d),g.isAwaitingApproval=a.computed(e),g.isBeingModified=a.observable(!1),g.thumbnailUrl=a.observable(b.thumbnailUrl),g.iconUrl=b.iconUrl,g.url=b.url,g.progress=a.observable(b.progress?parseInt(b.progress,10):null),g.shouldShowProgressBar=a.computed(f)};return b}),AWPCP.define("awpcp/media-manager",["jquery","knockout","awpcp/file-view-model","awpcp/settings"],function(a,b,c,d){var e=function(e){function f(b){return a.map(b,function(a){return new c(a)})}function g(){return h("images")}function h(a){return e.allowed_files[a]&&e.allowed_files[a].hasOwnProperty("mime_types")?i(D.files(),e.allowed_files[a].mime_types):[]}function i(b,c){return a.grep(b,function(b){return a.inArray(b.mimeType,c)!==-1})}function j(){return h("videos")}function k(){return h("others")}function l(){return D.images().length>0}function m(){return D.videos().length>0}function n(){return D.others().length>0}function o(b){b.isBeingModified(!0),a.post(d.get("ajaxurl"),{nonce:e.nonce,action:"awpcp-set-file-as-primary",listing_id:b.listingId,file_id:b.id},function(c){"ok"===c.status&&(a.each(p(b),function(a,b){b.isPrimary(!1)}),b.isPrimary(!0),b.isBeingModified(!1))})}function p(b){var c=null;return a.each(e.allowed_files,function(d,e){if(a.inArray(b.mimeType,e.mime_types)!==-1)return c=e.mime_types,!1}),null===c?[]:i(D.files(),c)}function q(a){s(a,!0)}function r(a){s(a,!1)}function s(b,c){b.isBeingModified()||(b.isBeingModified(!0),a.post(d.get("ajaxurl"),{nonce:e.nonce,action:"awpcp-update-file-enabled-status",listing_id:b.listingId,file_id:b.id,new_status:c},function(a){"ok"===a.status&&b.enabled(c),b.isBeingModified(!1)}))}function t(b){b.isBeingModified(!0),a.post(d.get("ajaxurl"),{nonce:e.nonce,action:"awpcp-delete-file",listing_id:b.listingId,file_id:b.id},function(c){"ok"===c.status&&(a.publish("/file/deleted",{type:b.mimeType}),D.files.remove(b),b.isBeingModified(!1),b.isPrimary()&&D.files().length>0&&D.setFileAsPrimary(D.files()[0]))})}function u(b){b.isBeingModified(!0),a.post(d.get("ajaxurl"),{nonce:e.nonce,action:"awpcp-approve-file",listing_id:b.listingId,file_id:b.id},function(a){"ok"===a.status&&(b.status("Approved"),b.isBeingModified(!1))})}function v(b){b.isBeingModified(!0),a.post(d.get("ajaxurl"),{nonce:e.nonce,action:"awpcp-reject-file",listing_id:b.listingId,file_id:b.id},function(a){"ok"===a.status&&(b.status("Rejected"),b.isBeingModified(!1))})}function w(a){var b=["awpcp-uploaded-file"];return b.push(a.enabled()?"is-enabled":"is-disabled"),b.push("is-"+a.status().toLowerCase()),a.isPrimary()&&b.push("is-primary"),b.join(" ")}function x(a){return"file-"+a.id}function y(a,b){D.files.push(new c({id:b.id,name:b.name,mimeType:b.type,status:"Approved",progress:b.percent}))}function z(b,c,d){a.each(D.files(),function(a,b){b.id===d.id&&b.progress(d.percent)})}function A(b,d,e){var f=null;a.each(D.files(),function(a,b){b.id===d.id&&(f=a)}),null!=f?D.files.splice(f,1,new c(e)):D.files.push(new c(e))}function B(b,c){var d=null;a.each(D.files(),function(a,b){b.id===c.id&&(d=a)}),null!=d&&D.files.splice(d,1)}function C(b,c,d,e){a.each(D.files(),function(a,b){b.id===d.id&&b.thumbnailUrl(e)})}var D=this;D.files=b.observableArray(f(e.files)),D.images=b.computed(g),D.videos=b.computed(j),D.others=b.computed(k),D.haveImages=b.computed(l),D.haveVideos=b.computed(m),D.haveOtherFiles=b.computed(n),D.showAdminActions=b.observable(!!e.show_admin_actions),D.enableFile=q,D.disableFile=r,D.deleteFile=t,D.setFileAsPrimary=o,D.approveFile=u,D.rejectFile=v,D.getFileCSSClasses=w,D.getFileId=x,a.subscribe("/file/added",y),a.subscribe("/file/uploaded",A),a.subscribe("/file/progress",z),a.subscribe("/file/failed",B),a.subscribe("/file/thumbnail-updated",C)};return e}),AWPCP.define("awpcp/listings-media-uploader-view",["jquery","awpcp/media-uploader-view","awpcp/settings"],function(a,b,c){var d=b.extend({initialize:function(){var a=this;a._super("initialize"),a.listenTo(a.model,"media-uploader:file-uploaded",_.bind(a.updateUploadRestrictionsMessage,a)),a.listenTo(a.model,"media-uploader:file-deleted",_.bind(a.updateUploadRestrictionsMessage,a)),a.configureBeforeUnloadEventHandler(),a.updateUploadRestrictionsMessage()},configureBeforeUnloadEventHandler:function(){var a=this;window.onbeforeunload=function(){return!!a.model.uploader&&(a.model.uploader.state===plupload.STARTED?c.l10n("media-uploader-beforeunload","files-are-being-uploaded"):a.model.uploader.total.queued>0?c.l10n("media-uploader-beforeunload","files-pending-to-be-uploaded"):0===a.model.uploader.total.uploaded&&c.get("show-popup-if-user-did-not-upload-files")?c.l10n("media-uploader-beforeunload","no-files-were-uploaded"):void 0)}},updateUploadRestrictionsMessage:function(){this.$restrictions.html(this.model.buildUploadRestrictionsMessage())}});return d}),Backbone.View.prototype._super=function(a){return this.constructor.__super__[a].apply(this,_.rest(arguments))},AWPCP.define("awpcp/media-uploader-view",["jquery"],function(){var a=Backbone.View.extend({initialize:function(){var a=this.render();a.$dropzone=a.$(".awpcp-media-uploader-dropzone"),a.$browseButton=a.$(".awpcp-media-uploader-browser-button"),a.$restrictions=a.$(".awpcp-media-uploader-restrictions"),a.$dropzone.on("dragover",_.bind(a.onDragOver,a)),a.$dropzone.on("dragleave",_.bind(a.onDragLeave,a)),a.$dropzone.on("drop",_.bind(a.onDragStop,a)),a.model.prepareUploader(a.$el,a.$dropzone,a.$browseButton)},render:function(){var a=this;return a},onDragOver:function(){this.$dropzone.addClass("awpcp-media-uploader-dropzone-active")},onDragLeave:function(){this.$dropzone.removeClass("awpcp-media-uploader-dropzone-active")},onDragStop:function(){this.$dropzone.removeClass("awpcp-media-uploader-dropzone-active")}});return a}),AWPCP.define("awpcp/media-uploader",["jquery","awpcp/settings"],function(a,b){var c=Backbone.Model.extend({initialize:function(){a.subscribe("/file/deleted",_.bind(this.onFileDeleted,this))},prepareUploader:function(a,c,d){var e=this;plupload.addFileFilter("restrict_file_size",_.bind(e.filterFileBySize,e)),plupload.addFileFilter("restrict_file_count",_.bind(e.filterFileByCount,e)),e.uploader=new plupload.Uploader({browse_button:d.get(0),url:b.get("ajaxurl"),container:a.get(0),drop_element:c.get(0),filters:{mime_types:e.getFileTypeFilters(),restrict_file_size:!0,restrict_file_count:!0},multipart_params:{action:"awpcp-upload-listing-media",listing:e.get("settings").listing_id,context:e.get("settings").context,nonce:e.get("settings").nonce},multi_selection:!0,chunk_size:"10000000",runtimes:"html5,flash,silverlight,html4",flash_swf_url:e.get("settings").flash_swf_url,silverlight_xap_url:e.get("settings").silverlight_xap_url}),e.uploader.init(),e.uploader.bind("FilesAdded",e.onFilesAdded,e),e.uploader.bind("UploadProgress",e.onUploadProgress,e),e.uploader.bind("FileUploaded",e.onFileUploaded,e)},filterFileBySize:function(c,d,e){var f,g=this,h=g.getFileGroup(d);return null===h?e(!1):d.size>h.max_file_size?(f=b.l10n("media-uploader-strings","file-is-too-large"),f=f.replace("<filename>","<strong>"+d.name+"</strong>"),f=f.replace("<bytes-count>","<strong>"+h.max_file_size+"</strong>"),a.publish("/messages/media-uploader",{type:"error",content:f}),e(!1)):e(!0)},getFileGroup:function(b){var c=this,d=null;return a.each(c.get("settings").allowed_files,function(c,e){if(a.inArray(b.type,e.mime_types)!==-1)return d=e,!1}),d},filterFileByCount:function(c,d,e){var f,g=this,h=g.getFileGroup(d);return null===h?e(!1):h.uploaded_file_count>=h.allowed_file_count?(f=b.l10n("media-uploader-strings","cannot-add-more-files"),f=f.replace("<filename>","<strong>"+d.name+"</strong>"),a.publish("/messages/media-uploader",{type:"error",content:f}),e(!1)):(h.uploaded_file_count=h.uploaded_file_count+1,e(!0))},getFileTypeFilters:function(){var b=this;return a.map(b.get("settings").allowed_files,function(a,b){return{title:b.substr(0,1).toUpperCase()+b.substr(1),extensions:a.extensions.join(",")}})},onFilesAdded:function(b,c){a.each(c,function(b,c){a.publish("/file/added",c)}),b.start()},onUploadProgress:function(b,c){a.publish("/file/progress",[b,c])},onFileUploaded:function(b,c,d){var e=a.parseJSON(d.response);"ok"===e.status&&e.file?a.publish("/file/uploaded",[c,e.file]):"ok"!==e.status&&(this.decreaseFileCountInGroup(c),c.status=plupload.FAILED,this.uploader.trigger("UploadProgress",c),a.publish("/file/failed",c),a.publish("/messages/media-uploader",{type:"error",content:e.errors.join(" ")})),this.trigger("media-uploader:file-uploaded")},onFileDeleted:function(a,b){this.decreaseFileCountInGroup(b),this.trigger("media-uploader:file-deleted")},decreaseFileCountInGroup:function(a){var b=this.getFileGroup(a);null!==b&&(b.uploaded_file_count=b.uploaded_file_count-1)},buildUploadRestrictionsMessage:function(){var c=this,d="",e=[],f={},g=0,h=0;return b.l10n("media-uploader-strings","upload-restrictions"),a.each(c.get("settings").allowed_files,function(a,b){g=b.allowed_file_count-b.uploaded_file_count,g>0&&(e.push(a),h=b.max_file_size/1e6,h=Math.round(10*h)/10,f["<"+a+"-left>"]="<strong>"+g+"</strong>",f["<"+a+"-max-file-size>"]="<strong>"+h+" MB</strong>")}),d=b.l10n("media-uploader-strings","upload-restrictions-"+e.sort().join("-")),a.each(f,function(a,b){d=d.replace(a,b)}),d}});return c}),AWPCP.define("awpcp/media-center",["jquery","knockout","awpcp/media-manager","awpcp/media-uploader","awpcp/listings-media-uploader-view","awpcp/thumbnails-generator","awpcp/jquery-messages"],function(a,b,c,d,e,f){var g=function(g,h){var i=this;i.container=a(g);var j=i.container.find(".awpcp-media-manager"),k=i.container.find("#awpcp-media-uploader"),l=i.container.find(".awpcp-thumbnails-generator");if(i.container.find(".awpcp-messages").AWPCPMessages(),j.length&&h.mediaManagerOptions&&b.applyBindings(new c(h.mediaManagerOptions),j.get(0)),k.length&&h.mediaUploaderOptions){var m=new d({settings:h.mediaUploaderOptions});a.noop(new e({el:k,model:m}))}l.length&&a.noop(new f(l))};return a.fn.StartMediaCenter=function(b){a(this).each(function(){a.noop(new g(a(this),b))})},g}),AWPCP.define("awpcp/jquery-messages",["jquery","knockout","awpcp/messages","awpcp/settings"],function(a,b,c,d){a.fn.AWPCPMessages=function(){return a(this).each(function(){var e=d.get("messages-data-for-"+a(this).attr("data-component-id"));b.applyBindings(new c(e),a(this).get(0))})}}),AWPCP.define("awpcp/messages",["jquery","knockout"],function(a,b){var c=function(c){function d(a,b){f.messages.push(b),e()}function e(){setTimeout(function(){var a=f.messages().length;a>10&&f.messages.splice(0,a-10)},2e4)}var f=this;f.messages=b.observableArray([]),a.each(c.channels,function(b,c){a.subscribe("/messages/"+c,d)})};return c}),AWPCP.define("awpcp/multiple-region-selector-validator",["jquery"],function(a){var b=function(){};return a.extend(b.prototype,{showErrorsIfUserSelectedDuplicatedRegions:function(b){var c=this,d=a(b),e=c.getMultipleRegionSelectorInstance(d),f=!1;return"undefined"!=typeof e&&(d.find(".multiple-region:visible").each(function(){e.checkDuplicatedRegionsForField(a(this).attr("id"),!0)&&(f=!0)}),f)},getMultipleRegionSelectorInstance:function(a){return a.find(".awpcp-multiple-region-selector").data("RegionSelector")},showErrorsIfRequiredFieldsAreEmpty:function(b){var c=a(b),d=this.getMultipleRegionSelectorInstance(c),e=null,f=!1;return d?(a.each(d.regions(),function(b,c){a.each(c.partials(),function(a,b){if(b.config.required){var d=b.selected();d&&d.length||(c.error(AWPCP.l10n("multiple-region-selector","missing-"+b.type)),e=e?e:b,f=!0)}})}),e&&c.find('[id="'+e.id+'"]').closest(".awpcp-region-selector-partials").find(":input:visible").last().focus(),f):f}}),new b}),AWPCP.define("awpcp/payment-terms-list",["jquery","awpcp/settings"],function(a,b){var c=function(b,c){var d=this;d.$container=b,d.options=c,this.container=b,this.state={allPaymentTerms:this.container.find(".awpcp-payment-term")},a.subscribe("/categories/change",_.bind(this.onCategoriesUpdated,this)),a.subscribe("/user/updated",_.bind(this.onUserUpdated,this)),d.$container.on("change",'[name="payment_term"]',function(){d.onChange()}),this.update()};return a.extend(c.prototype,{onCategoriesUpdated:function(c,d,e){a.contains(d.closest("form").get(0),this.container.get(0))&&(null!==e||b.get("hide-all-payment-terms-if-no-category-is-selected"))&&(a.isArray(e)?this.state.selectedCategories=e:this.state.selectedCategories=[e],this.update())},onUserUpdated:function(a,b){b&&b.payment_terms&&(this.state.userPaymentTerms=b.payment_terms,this.update())},onChange:function(){var b=this;a.isFunction(b.options.onChange)&&b.options.onChange(b.getSelectedPaymentTerm())},getSelectedPaymentTerm:function(){var a=this,b=a.$container.find('[name="payment_term"]:checked');return b.length?{id:b.data("payment-term-id"),type:b.data("payment-term-type"),mode:b.data("payment-term-mode"),summary:b.data("payment-term-summary"),maxCategories:b.parents("li").data("number-of-categories-allowed")}:null},clearSelectedPaymentTerm:function(){var a=this;a.$container.find('[name="payment_term"]').prop("checked",!1),a.update()},includesFreePaymentTermOnly:function(){var a=this.state.allPaymentTerms.length;if(1!==a)return!1;for(var b=a-1;b>=0;b-=1)if("fee-0"!==this.state.allPaymentTerms.eq(b).data("id"))return!1;return!0},update:function(){var a=this._getDisabledPaymentTerms(),b=this.state.allPaymentTerms.not(a.get());if(0===b.find(":radio:checked").length){var c=b.eq(0).find(":radio:first");c.prop?c.prop("checked",!0):c.attr("checked","checked"),c.trigger("change")}b.fadeIn(),a.fadeOut()},isMaxCategories:function(){a(".awpcp-submit-listing-page-form select[name='category[]']").parent(".awpcp-form-spacer").find(".awpcp-message-error").remove();var b=a.AWPCP.get("default-validation-messages").maxCategories,c=this.state.selectedCategories,d=a(".awpcp-submit-listing-page-form .select2-selection--multiple").length>0;"undefined"!=typeof c&&null!==c&&c.length>0&&!isNaN(c[0])&&d&&this.state.selectedCategories.length>=this.getSelectedPaymentTerm().maxCategories&&a(".awpcp-submit-listing-page-form select[name='category[]']").parent(".awpcp-form-spacer").append('<p class="awpcp-message awpcp-message-error">'+b+"</p>")},_getDisabledPaymentTerms:function(){var c=this,d=c.state.selectedCategories;return(null===d||"undefined"==typeof d||0===d.length)&&b.get("hide-all-payment-terms-if-no-category-is-selected")||"0"==AWPCPSubmitListingPageData.payments_enabled?c.state.allPaymentTerms:c.state.allPaymentTerms.filter(function(){var b=a(this);return!(!c.state.userPaymentTerms||c._isUserPaymentTerm(b))||!(!c.state.selectedCategories||c._isPaymentTermAvailableForCategories(b))})},_isUserPaymentTerm:function(b){return a.inArray(b.attr("data-id"),this.state.userPaymentTerms)!==-1},_isPaymentTermAvailableForCategories:function(b){var c=a.parseJSON(b.attr("data-categories")),d=parseInt(b.attr("data-number-of-categories-allowed"),10);return!(this.state.selectedCategories.length>d)&&(!a.isArray(c)||0===c.length||(c=a.map(c,function(a){return parseInt(a,10)}),0===_.difference(this.state.selectedCategories,c).length))}}),c}),AWPCP.define("awpcp/thumbnails-generator",["jquery","awpcp/settings"],function(a,b){var c=0,d=1,e=function(e){function f(a,b){b.type.match("video.*")&&(n.queue.push({video:b,thumbnail:null}),g())}function g(){n.status===c&&(setTimeout(h,100),n.status=d)}function h(){var a=n.video.get(0);return n.index<n.queue.length?(n.currentItem=n.queue[n.index],n.index=n.index+1,a.src=URL.createObjectURL(n.currentItem.video.getNative()),a.play(),void 0):(n.status=c,void(a.src=null))}function i(){var b=this;a.isNumeric(b.duration)&&!isNaN(b.duration)&&Math.abs(b.currentTime-b.duration/2)>1&&(b.currentTime=b.duration/2,b.pause())}function j(){n.currentItem.thumbnail=k(),setTimeout(h,100)}function k(){var a,b=n.video.get(0),c=n.canvas.get(0);return c.width=b.clientWidth,c.height=b.clientHeight,a=c.getContext("2d"),a.drawImage(b,0,0,c.width,c.height),c.toDataURL()}function l(b,c,d){var e=null;a.each(n.queue,function(a,b){b.video.id===c.id&&(e=b.thumbnail)}),null!==e&&m(c,d,e)}function m(c,d,e){a.post(b.get("ajaxurl"),{action:"awpcp-upload-generated-thumbnail",nonce:n.element.attr("data-nonce"),file:d.id,thumbnail:e},function(b){"ok"===b.status&&a.publish("/file/thumbnail-updated",[c,d,b.thumbnailUrl])})}var n=this;n.element=a(e),n.video=n.element.find("video"),n.canvas=n.element.find("canvas"),n.queue=[],n.index=0,n.status=c,"undefined"!=typeof n.video.get(0).canPlayType&&"undefined"!=typeof URL&&"undefined"!=typeof URL.createObjectURL&&(a.subscribe("/file/added",f),a.subscribe("/file/uploaded",l),n.video.bind("canplay",i),n.video.bind("seeked",j))};return e}),AWPCP.define("awpcp/user-information-updater",["jquery"],function(a){var b=function(a){var b=this;b.container=a,b.name=b.container.find("input[name=ad_contact_name]"),b.email=b.container.find("input[name=ad_contact_email]"),b.website=b.container.find("input[name=websiteurl]"),b.phone=b.container.find("input[name=ad_contact_phone]"),b.state=b.container.find("input[name=ad_state], select[name=ad_state]"),b.city=b.container.find("input[name=ad_city], select[name=ad_city]")};return a.extend(b.prototype,{watch:function(){var b=this;a.subscribe("/user/updated",function(a,c,d){b.update(c,d)})},update:function(b,c){var d,e,f=this,g={};d={name:f.name.val(),email:f.email.val(),website:f.website.val(),phone:f.phone.val(),state:f.state.val(),city:f.city.val()},e={name:b.display_name,email:b.user_email,website:b.user_url,phone:b.phone,
state:b.state,city:b.city},a.each(d,function(a){d[a]&&d[a].length>0&&!c?g[a]=d[a]:g[a]=e[a]?e[a]:""}),f.name.val(g.name),f.email.val(g.email),f.website.val(g.website),f.phone.val(g.phone),this.city.one("awpcp-update-region-options-completed",function(){f.city.val(g.city).change()}),this.state.val(g.state).change()}}),b}),AWPCP.define("awpcp/user-selector",["jquery"],function(a){var b=function(b,c){var d=this;return d.$select=a(b),d.options=c,"undefined"!=typeof d.options&&("ajax"===d.options.mode?d.configureAjaxBehavior():d.configureInlineBehavior())};return a.extend(b.prototype,{configureAjaxBehavior:function(){var b=this,c=a.extend(!0,{},b.options.select2,{ajax:{processResults:function(b){var c=a.map(b.items,function(a){return{id:a.ID,text:a.public_name}});return{results:c}}}});if(b.$select.selectWoo(c),b.options.selected.id){var d=new Option(b.options.selected.text,b.options.selected.id,(!0),(!0));b.$select.append(d).trigger("change")}b.setupEventHandlers()},setupEventHandlers:function(){var a=this;a.$select.on("change.select2",function(){a.onChange()})},configureInlineBehavior:function(){var a=this;a.$select.selectWoo(a.options.select2),a.setupEventHandlers()},onChange:function(){var b=this;a.isFunction(b.options.onChange)&&b.options.onChange(b.getSelectedUser())},getSelectedUser:function(){var a=this,b=a.$select.selectWoo("data");return b&&b.length?{id:b[0].id,name:b[0].text}:{id:0,name:""}},clearSelectedUser:function(){var a=this;a.$select.val(null).trigger("change")}}),b}),AWPCP.run("awpcp/restricted-length-field",["jquery"],function(a){var b=function(b){var c=this;c.element=a(b),c.container=c.element.parent().find(".characters-left"),c.placeholder=c.container.find(".characters-left-placeholder"),c.allowed=parseInt(c.element.attr("data-max-characters"),10),c.remaining=parseInt(c.element.attr("data-remaining-characters"),10),c.element.bind("keyup keydown",function(){var a,b=c.element.val();c.allowed<=0||(b.length>c.allowed&&(b=b.substring(0,c.allowed),c.element.val(b)),a=c.allowed-b.length,c.container.removeClass("awpcp-almost-no-characters-left"),c.container.removeClass("awpcp-no-characters-left"),a>0&&a<=20&&c.container.addClass("awpcp-almost-no-characters-left"),a<=0&&c.container.addClass("awpcp-no-characters-left"),c.placeholder.text(a))}).trigger("keyup")};return b}),AWPCP.define("awpcp/util/guid",[],function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return{generate:function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}}),AWPCP.define("awpcp/util/number-format",["awpcp/settings"],function(a){var b={format:function(b,c,d,e){c=isNaN(c=Math.abs(c))?2:c,e=void 0===e?".":a.get("decimal-separator"),d=void 0===d?",":a.get("thousands-separator");var f,g=Math.abs(+b||0).toFixed(c),h=parseInt(g,10).toString(),i=h.length>3?h.length%3:0;return f=i?h.substr(0,i):"",f+=h.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+d),c&&(f+=e+Math.abs(g-h).toFixed(c).slice(2)),b>=0?f:"("+f+")"}};return b}),AWPCP.define("awpcp/asynchronous-tasks",["jquery","knockout","moment","awpcp/asynchronous-task","awpcp/asynchronous-tasks-group","awpcp/knockout-progress"],function(a,b,c,d,e){function f(a){this.title=b.observable(a.title),this.introduction=b.observable(a.introduction),this.submit=b.observable(a.submit),this.templates=a.templates,this.group=new e({tasks:this._getTasksGroups(a)}),b.observableArray([])}return a.extend(f.prototype,{_getTasksGroups:function(b){var c=this,d=[];return a.each(b.groups,function(a,b){d.push(new e({title:b.title,content:b.content,successTitle:b.successTitle,successContent:b.successContent,tasks:c._getTasks(b)}))}),d},_getTasks:function(b){var c=this,e=[];return a.each(b.tasks,function(a,b){e.push(new d({name:b.name,description:b.description,action:b.action,context:b.context,recordsCount:b.recordsCount,recordsLeft:b.recordsLeft,templates:c.templates}))}),e},render:function(c){b.applyBindings(this,a(c).get(0))},start:function(){this.group.execute()}}),f}),AWPCP.define("awpcp/asynchronous-tasks-group",["jquery","knockout","moment","awpcp/asynchronous-task"],function(a,b,c,d){var e=function(c){this.title=b.observable(c.title),this.content=b.observable(c.content),this.successTitle=b.observable(c.successTitle),this.successContent=b.observable(c.successContent),this.tasks=b.observableArray(c.tasks),this.startTime=b.observable(null),this.lastUpdatedTime=b.observable(null),this.tasksCount=this.tasks().length,this.currentTaskIndex=b.observable(0),this.tasksCompleted=b.observable(0),this.tasksLeft=b.computed(function(){return this.tasksCount-this.tasksCompleted()},this),this.running=b.observable(!1),this.completed=b.computed(function(){return 0===this.tasksLeft()},this),this.percentageOfCompletion=b.computed(function(){var b=this.tasks(),c=0,d=0;return a.each(b,function(a,b){c+=b.getWeight(),d+=b.isCompleted()?b.getWeight():b.getWeight()*b.getPercentageOfCompletion()/100}),Math.round(d/c*1e4)/100},this).extend({throttle:1}),this.percentageOfCompletionString=b.computed(function(){return Math.round(this.percentageOfCompletion())+"%"},this),this.updateCurrentTaskIndexAndCompletedTasksCount()};return a.extend(e.prototype,d.prototype,{updateCurrentTaskIndexAndCompletedTasksCount:function(){var b=this.currentTaskIndex(),c=this.tasksCompleted();a.each(this.tasks(),function(a,d){d.completed()&&(b+=1,c+=1)}),this.tasks.sort(function(a,b){return a.completed()<b.completed()?1:a.completed()==b.completed()?0:-1}),this.currentTaskIndex(b),this.tasksCompleted(c)},getRemainingTime:function(){return this.remainingTime},getPercentageOfCompletion:function(){return this.percentageOfCompletion()},getWeight:function(){return this.tasksCount},execute:function(b){var c=this,d=c.currentTaskIndex();if(d>=c.tasksCount){if(c.running(!1),a.isFunction(b))return b()}else c.tasks()[d].execute(function(){c.currentTaskIndex(c.currentTaskIndex()+1),c.tasksCompleted(c.tasksCompleted()+1),setTimeout(function(){c.execute(b)},1)});c.running(!0)}}),e}),AWPCP.define("awpcp/asynchronous-task",["jquery","knockout","moment","awpcp/settings"],function(a,b,c,d){var e=function(a){this.name=b.observable(a.name),this.description=b.observable(a.description),this.action=a.action,this.context=a.context,this.startTime=b.observable(null),this.lastUpdatedTime=b.observable(null),this.failedRequestsCount=b.observable(0),"undefined"==typeof a.recordsCount?this.recordsCount=b.observable(null):this.recordsCount=b.observable(a.recordsCount),"undefined"==typeof a.recordsLeft?this.recordsLeft=b.observable(null):this.recordsLeft=b.observable(a.recordsLeft),this.templates=a.templates,this.numberOfRecordsProcessed=b.computed(function(){var a=this.recordsCount(),b=this.recordsLeft();return null!==a&&null!==b?a-b:0},this),this.numberOfRecordsProcessedMessage=b.computed(function(){var a=this.numberOfRecordsProcessed(),b=this.recordsCount(),c=this.templates.itemsProcessed;return c=c.replace("<number-of-items-processed>",a),c=c.replace("<total-number-of-items>",b)},this),this.running=b.observable(!1),this.completed=b.computed(function(){return 0===this.recordsLeft()},this),this.initialPercentageOfCompletion=b.observable(0),this.percentageOfCompletion=b.computed(function(){var a,b=this.recordsCount(),c=this.recordsLeft();return null===c||null===b?a=0:0===c?a=100:b>0&&(a=100*(b-c)/b),Math.round(100*a)/100},this).extend({throttle:1}),this.percentageOfCompletionString=b.computed(function(){return Math.round(this.percentageOfCompletion())+"%"},this),this.remainingTime=b.computed(function(){var a=new Date,b=null;return function(){var d,e,f,g,h=this.startTime(),i=this.lastUpdatedTime(),j=this.initialPercentageOfCompletion(),k=this.percentageOfCompletion(),l=new Date;return l-a<2500?b:null===h||null===i?null:0===k?null:(d=k-j,e=100-k,f=i-h,g=e*f/d/1e3,a=l,b=g>0?c(l).add(g,"seconds").from(l,!0):null)}}(),this)};return a.extend(e.prototype,{getStartTime:function(){return this.startTime()},setStartTime:function(a){this.startTime(a)},getLastUpdatedTime:function(){return this.lastUpdatedTime()},setLastUpdatedTime:function(a){this.lastUpdatedTime(a)},getRemainingTime:function(){return this.remainingTime()},setInitialPercentageOfCompletion:function(a){this.initialPercentageOfCompletion(a)},getPercentageOfCompletion:function(){return this.percentageOfCompletion()},getWeight:function(){return 1},isCompleted:function(){return this.completed()},isRunning:function(){return this.running()},setStatusMessage:function(a){this.messages.status(a)},setErrorMessage:function(a){this.messages.error(a)},execute:function(b){var c=this,e=a.isFunction(b)?b:a.noop;null===c.getStartTime()&&(c.setStartTime(new Date),c.setInitialPercentageOfCompletion(c.getPercentageOfCompletion())),a.ajax(d.get("ajaxurl"),{method:"POST",data:{action:c.action,context:c.context},success:function(a,b,d){c._onSuccess(a,e)},error:function(a,b,d){"undefined"==typeof d.error&&(d={status:"error",error:d}),c._handleErrorResponse(d,e)}}),this.running(!0)},_onSuccess:function(a,b){"ok"===a.status?this._handleSuccessfulResponse(a,b):this._handleErrorResponse(a,b)},_handleSuccessfulResponse:function(a,b){var c=this;a.message&&c.setStatusMessage(a.message),c.failedRequestsCount(0),c.recordsCount(c.recordsCount()||parseInt(a.recordsCount,10)),c.recordsLeft(parseInt(a.recordsLeft,10)),c.setLastUpdatedTime(new Date),c._handleResponse(b,1)},_handleResponse:function(a,b){var c=this;0===c.recordsLeft()?(c.running(!1),a()):setTimeout(function(){c.execute(a)},b)},_handleErrorResponse:function(a,b){a.error;var c=this.failedRequestsCount();c<6&&this.failedRequestsCount(c+1),this._handleResponse(b,1e3*Math.pow(2,c))}}),e}),AWPCP.define("awpcp/collapsible",["jquery"],function(a){function b(a){this.element=a,this.handler=this.element.find(".js-handler").eq(0),this.subject=this.element.find("[data-collapsible]").eq(0)}return a.extend(b.prototype,{setup:function(){var a=this;return 0===a.subject.length?void a.handler.hide():(a.handler.click(function(b){a.toggle.apply(a,[b,this])}),a.subject.is("[awpcp-keep-open]")?void a.showExpanded():void a.showCollapsed())},showExpanded:function(){var a=this;a.subject.show(),a.setHandlerClass("close")},showCollapsed:function(){var a=this;a.subject.hide(),a.setHandlerClass("open")},setHandlerClass:function(a){this.handler.find("span").removeClass("open close").addClass(a)},toggleHandlerClass:function(){this.subject.is(":visible")?this.setHandlerClass("close"):this.setHandlerClass("open")},toggle:function(a){var b=this;a.preventDefault(),b.subject.stop().slideToggle(function(){b.toggleHandlerClass()})}}),b}),AWPCP.define("awpcp/localization",["jquery"],function(a){return{get:function(b,c){return a.AWPCP.l10n(b,c)}}}),AWPCP.define("awpcp/settings",["jquery"],function(a){return a.AWPCP}),AWPCP.define("awpcp/users-autocomplete",["jquery","awpcp/settings"],function(a,b){function c(b){var c=this;c.field=a(b),c.hidden=c.field.siblings("[autocomplete-selected-value]"),c.previous_value=null}return a.extend(c.prototype,{setup:function(){var c=this,d=b.get("users-autocomplete-default-user");c.field.autocomplete({source:function(c,d){a.getJSON(b.get("ajaxurl"),{action:"awpcp-autocomplete-users",term:c.term},function(a){"ok"===a.status&&d(a.items)})},select:function(a,b){b.item&&c.update(b.item)}}),d&&c.init(d)},init:function(b){var c=this;c.hidden.val(b.ID),c.field.val(b.public_name),c.previous_value=parseInt(c.hidden.val(),10),a.publish("/user/updated",[b,!1])},update:function(b){var c,d=this;d.hidden.val(b.ID),d.field.val(b.public_name),d.previous_value=parseInt(d.hidden.val(),10),c=b.ID!==d.previous_value,a.publish("/user/updated",[b,c])}}),c}),AWPCP.define("awpcp/users-dropdown",["jquery"],function($){function UsersDropdown(a){var b=this;b.field=$(a),b.previous_value=null}return $.extend(UsersDropdown.prototype,{setup:function(){var a=this,b=a.getSelectedUserId();a.field.change(function(){a.getSelectedUserId()>0?a.update(a.getSelectedUser()):a.previous_value=0}),b>0&&a.init(a.getSelectedUser())},getSelectedUserId:function(){return parseInt(this.field.val(),10)},getSelectedUser:function(){var user_information=this.field.find(":selected").attr("data-user-information");return user_information&&$.parseJSON?$.parseJSON(user_information):user_information?eval("("+user_information+")"):null},init:function(a){this.previous_value=a.ID,$.publish("/user/updated",[a,!1])},update:function(a){var b=this.previous_value!==a.ID;$.publish("/user/updated",[a,b]),this.previous_value=a.ID}}),UsersDropdown}),AWPCP.define("awpcp/jquery-userfield",["jquery","awpcp/users-dropdown","awpcp/users-autocomplete"],function(a,b,c){a.fn.userfield=function(){return a(this).each(function(){var d,e=a(this);e.is("[dropdown-field]")?d=new b(e):e.is("[autocomplete-field]")&&(d=new c(e)),d.setup()})}}),AWPCP.define("awpcp/jquery-collapsible",["jquery","awpcp/collapsible"],function(a,b){a.fn.collapsible=function(){return a(this).each(function(){var c=new b(a(this));c.setup()})}}),AWPCP.define("awpcp/jquery-validate-methods",["jquery"],function(a){return a(function(){"undefined"!=typeof a.validator&&(a.extend(a.validator.messages,a.AWPCP.get("default-validation-messages")),a.validator.addMethod("oneof",function(b,c,d){return!!this.optional(c)||a.inArray(b,d)!==-1}),a.validator.addMethod("classifiedsurl",function(a,b){return this.optional(b)||/^(?:(https?|s?ftp):\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)}),a.validator.addMethod("money",function(){var b=a.AWPCP.get("decimal-separator"),c=a.AWPCP.get("thousands-separator"),d=new RegExp("^-?(?:\\d+|\\d{1,3}(?:\\"+c+"\\d{3})+)?(?:\\"+b+"\\d+)?$");return function(a,b){return this.optional(b)||d.test(a)}}()),a.validator.addClassRules("integer",{integer:!0}),a.validator.setDefaults({errorClass:"error invalid",errorElement:"span",errorPlacement:function(b,c){b.addClass("awpcp-error");var d=["payment_term","credit_plan","payment_method"];a.inArray(c.attr("name"),d)!==-1?b.insertBefore(c.closest("table")):c.closest(".awpcp-form-spacer").length&&b.appendTo(c.closest(".awpcp-form-spacer"))}}))}),!0}),AWPCP.run("awpcp/init-collapsible-elements",["jquery","awpcp/jquery-collapsible"],function(a){a(function(){a(".awpcp-categories-list .top-level-category").closest("li").collapsible()})}),AWPCP.run("awpcp/init-categories-dropdown",["jquery","awpcp/categories-selector"],function(a,b){a(function(){a(".awpcp-category-dropdown[data-auto]").each(function(){a.noop(new b(a(this)))})})}),AWPCP.run("awpcp/init-category-selector",["jquery"],function(a){a(function(){var b=a(".awpcp-category-switcher .awpcp-category-dropdown");a.subscribe("/categories/change",function(a,c,d){-1!==b.index(c)&&d&&c.closest("form").submit()})})}),AWPCP.run("awpcp/reload-payment-completed-page",["jquery"],function(a){a(function(){var b=a("#awpcp-payment-completed-form");if(0!==b.length){var c=b.find(':hidden[name="payment_status"]').val();"Not Verified"===c&&setTimeout(function(){location.reload()},5e3)}})}),AWPCP.run("awpcp/init-recaptcha",["jquery"],function(a){function b(){if(!window.AWPCPGetReCaptchaResponse){var b=a(".awpcp-recaptcha");b.length&&c(b);var e=a(".awpcp-recaptcha-action");e.length&&d(e)}}function c(b){b.each(function(){var b,c=a(this);c.data("awpcp-recaptcha")||(b=grecaptcha.render(this,{sitekey:c.attr("data-sitekey"),theme:"light"}),c.data("awpcp-recaptcha",!0),c.attr("data-recaptcha-widget-id",b))}),window.AWPCPGetReCaptchaResponse=function(a){a()}}function d(a){var b=a.eq(0);window.AWPCPGetReCaptchaResponse=function(a){grecaptcha.execute(b.data("sitekey"),{action:b.data("name")}).then(function(c){b.find(":hidden").val(c),a()})}}var e=45,f=0,g=1500,h=!1,i=function(){f+=1,"undefined"!=typeof grecaptcha&&"undefined"!=typeof grecaptcha.render?b():f<=e&&(h=setTimeout(i,g*Math.pow(f/e,2)))};window.AWPCPreCAPTCHAonLoadCallback=function(){h&&clearTimeout(h),b()},a(i)});